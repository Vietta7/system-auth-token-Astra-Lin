# system-auth-token-Astra-Lin



```markdown
---
tags:
  - rutoken
  - security
  - authentication
  - astra-linux
  - 2fa
  - jwt
date: 2025-12-03
status: complete
version: 1.0.0
author: Security Team
---

# üîê –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Rutoken –¥–ª—è Astra Linux

> [!abstract] –û–ø–∏—Å–∞–Ω–∏–µ
> –°–∏—Å—Ç–µ–º–∞ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **—Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ Rutoken** (—Ä–æ—Å—Å–∏–π—Å–∫–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ –§–°–ë/–§–°–¢–≠–ö).

## üó∫Ô∏è –ù–∞–≤–∏–≥–∞—Ü–∏—è

```

TABLE WITHOUT ID
file.link AS "–†–∞–∑–¥–µ–ª",
file.tags AS "–¢–µ–≥–∏"
FROM "Rutoken"
WHERE contains(file.name, "Rutoken")

```

**–†–∞–∑–¥–µ–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**
- [[#–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏]]
- [[#–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã]]
- [[#–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏]]
- [[#–£—Å—Ç–∞–Ω–æ–≤–∫–∞]]
- [[#–ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã]]
- [[#–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ]]
- [[#–ú–µ—Ö–∞–Ω–∏–∑–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏]]
- [[#–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞]]
- [[#API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]]
- [[#Troubleshooting]]

---

## ‚ú® –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

> [!success] –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∑–∞—â–∏—Ç–∞
> –§–∏–∑–∏—á–µ—Å–∫–∏–π —Ç–æ–∫–µ–Ω (—á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å) + PIN-–∫–æ–¥ (—á—Ç–æ –≤—ã –∑–Ω–∞–µ—Ç–µ)

> [!info] –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
> - üá∑üá∫ **–û—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**: Rutoken (–ê–∫—Ç–∏–≤), [[Astra Linux]], –±–µ–∑ –∑–∞—Ä—É–±–µ–∂–Ω—ã—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤
> - üîë **JWT —Ç–æ–∫–µ–Ω—ã**: —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏
> - üõ°Ô∏è **Proof-of-possession**: –∑–∞—â–∏—Ç–∞ –æ—Ç –∫—Ä–∞–∂–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
> - üîÑ **Credentials versioning**: –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏
> - üö´ **Token Black-list**: –∑–∞—â–∏—Ç–∞ –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤

**–°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
- [[JWT —Ç–æ–∫–µ–Ω—ã]]
- [[PKCS11 —Å—Ç–∞–Ω–¥–∞—Ä—Ç]]
- [[–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è]]
- [[–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Ç–æ–∫–µ–Ω—ã]]

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```

graph TB
A[Rutoken USB] --> B[Python –∫–ª–∏–µ–Ω—Ç]
B --> C[HTTP Server]
C --> D[Auth Service]
D --> E[Rutoken Validator]
E --> F[Database]
D --> G[JWT Generator]
C --> H[Web Dashboard]

    style A fill:#ff6b6b
    style B fill:#4ecdc4
    style C fill:#45b7d1
    style D fill:#96ceb4
    style E fill:#ffeaa7
    style F fill:#dfe6e9
    style G fill:#a29bfe
    style H fill:#fd79a8
    ```

> [!tip] –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
> –°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É **–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤** –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç—è–∂—ë–ª—ã—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤

### –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ö–õ–ò–ï–ù–¢–°–ö–ê–Ø –ß–ê–°–¢–¨                             ‚îÇ
‚îÇ  (–ö–æ–º–ø—å—é—Ç–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å Rutoken)                            ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ  ‚îÇ   Rutoken    ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  Python –∫–ª–∏–µ–Ω—Ç      ‚îÇ              ‚îÇ
‚îÇ  ‚îÇ   (USB)      ‚îÇ  PKCS11 ‚îÇ  rutoken-client.py  ‚îÇ              ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ         ‚îÇ                     ‚îÇ              ‚îÇ
‚îÇ  ‚îÇ -  –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç ‚îÇ         ‚îÇ 1. –ß–∏—Ç–∞–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç‚îÇ              ‚îÇ
‚îÇ  ‚îÇ -  –ü—Ä–∏–≤–∞—Ç–Ω—ã–π  ‚îÇ         ‚îÇ 2. –°–æ–∑–¥–∞—ë—Ç proof    ‚îÇ              ‚îÇ
‚îÇ  ‚îÇ   –∫–ª—é—á       ‚îÇ         ‚îÇ 3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ‚îÇ              ‚îÇ
‚îÇ  ‚îÇ -  PIN –∑–∞—â–∏—Ç–∞ ‚îÇ         ‚îÇ 4. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä‚îÇ              ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
‚îÇ                                     ‚îÇ                            ‚îÇ
‚îÇ                                     ‚îÇ HTTPS/HTTP                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ
‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –°–ï–†–í–ï–†–ù–ê–Ø –ß–ê–°–¢–¨                              ‚îÇ
‚îÇ  (Astra Linux —Å–µ—Ä–≤–µ—Ä)                                           ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  HTTP Server (http_server.py)                            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  -  –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤                                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  -  –†–æ—É—Ç–∏–Ω–≥ API                                           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  -  –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã                                     ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                       ‚îÇ                                          ‚îÇ
‚îÇ                       ‚ñº                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Auth Service (auth_service.py)                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  -  –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤                                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  -  –ü—Ä–æ–≤–µ—Ä–∫–∞ proof-of-possession                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  -  –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤                                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  -  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏                                   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                       ‚îÇ                                          ‚îÇ
‚îÇ                       ‚ñº                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Rutoken Validator (rutoken_validator.py)                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  -  –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  -  –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ CA                                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  -  –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞                  ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                       ‚îÇ                                          ‚îÇ
‚îÇ                       ‚ñº                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Database (database.py)                                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  -  SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö                                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  -  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  -  Black-list —Ç–æ–∫–µ–Ω–æ–≤                                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  -  Credentials versioning                                ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

```

### –ü–æ—Ç–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

> [!example]- –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
> 
> **–®–∞–≥ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**
> ```
> # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç rutoken-client.py
> client = RutokenClient(SERVER_URL)
> client.check_rutoken()  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
> ```
> 
> **–®–∞–≥ 2: –ß—Ç–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞**
> ```
> certificate = client.read_certificate(user_pin)
> # –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —á–∏—Ç–∞–µ—Ç—Å—è —Å —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ PKCS#11
> ```
> 
> **–®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ proof-of-possession**
> ```
> proof = client.create_proof_of_possession(certificate, pin)
> # proof = SHA256(cert_hash + pin_hash + timestamp + serial)
> ```
> 
> **–®–∞–≥ 4: –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä**
> ```
> tokens = client.login(certificate, proof)
> # POST /api/auth/login
> ```
> 
> **–®–∞–≥ 5: –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤**
> ```
> # –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT
> access_token = generate_jwt(user_id, expires=15min)
> refresh_token = generate_jwt(user_id, expires=7days)
> ```

```

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç rutoken-client.py
‚îú‚îÄ –ü–æ–¥–∫–ª—é—á–∞–µ—Ç Rutoken –∫ USB
‚îú‚îÄ –í–≤–æ–¥–∏—Ç PIN-–∫–æ–¥
‚îî‚îÄ –ö–ª–∏–µ–Ω—Ç —á–∏—Ç–∞–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å —Ç–æ–∫–µ–Ω–∞
2. –°–æ–∑–¥–∞–Ω–∏–µ proof-of-possession
‚îú‚îÄ –•–µ—à —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
‚îú‚îÄ –•–µ—à PIN-–∫–æ–¥–∞
‚îú‚îÄ –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞
‚îî‚îÄ –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–æ–∫–µ–Ω–∞
3. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (POST /api/auth/login)
{
"certificate": "-----BEGIN CERTIFICATE-----...",
"signature": "proof_hash",
"data": "timestamp",
"token_serial": "383d5d3c"
}
4. –°–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ CA
‚îî‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤
‚îú‚îÄ Access Token (15 –º–∏–Ω—É—Ç)
‚îî‚îÄ Refresh Token (7 –¥–Ω–µ–π)
6. –í–æ–∑–≤—Ä–∞—Ç —Ç–æ–∫–µ–Ω–æ–≤ –∫–ª–∏–µ–Ω—Ç—É
{
"access_token": "eyJ...",
"refresh_token": "eyJ...",
"user_id": "user_86169016"
}
7. –û—Ç–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
‚îú‚îÄ URL: http://server/client/auth-success.html\#tokens
‚îú‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
‚îî‚îÄ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ dashboard
8. –†–∞–±–æ—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º–µ
‚îú‚îÄ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º: Authorization: Bearer <token>
‚îú‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Refresh Token
‚îî‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ Black-list –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
```

**–°–º. —Ç–∞–∫–∂–µ:**
- [[–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏]]
- [[JWT —Ç–æ–∫–µ–Ω—ã - –¥–µ—Ç–∞–ª–∏]]
- [[PKCS11 –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ]]

---

## üì¶ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å

> [!info] –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
> - [[Astra Linux]] 1.7/1.8 (Smolensk/Orel) –∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è

> [!code]- Python –ø–∞–∫–µ—Ç—ã
> ```
> python3 >= 3.9
> python3-jwt (PyJWT)
> python3-cryptography
> ```

> [!code]- –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
> ```
> librtpkcs11ecp     # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ PKCS#11 –¥–ª—è Rutoken
> openssl            # –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
> sqlite3            # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
> ```

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å

> [!info] –ê–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ
> - [[Rutoken]] lite / ECP / S –∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π
> - USB –ø–æ—Ä—Ç

> [!code]- –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ
> ```
> python3 >= 3.9
> python3-requests   # HTTP –∫–ª–∏–µ–Ω—Ç
> librtpkcs11ecp     # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ PKCS#11
> rutokenecp         # –î—Ä–∞–π–≤–µ—Ä—ã Rutoken
> pcscd              # –°–ª—É–∂–±–∞ PC/SC Smart Card
> pcsc-tools         # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–∫–µ–Ω–∞–º–∏
> opensc             # pkcs11-tool
> firefox –∏–ª–∏ chromium  # –ë—Ä–∞—É–∑–µ—Ä
> ```

**–ú–∞—Ç—Ä–∏—Ü–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä—Å–∏—è | –°—Ç–∞—Ç—É—Å |
|-----------|--------|--------|
| Astra Linux | 1.7 | ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |
| Astra Linux | 1.8 | ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ |
| Rutoken lite | –ª—é–±–∞—è | ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |
| Rutoken ECP | –ª—é–±–∞—è | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ (–±–µ–∑ –ø–æ–¥–ø–∏—Å–∏) |
| Python | 3.9+ | ‚úÖ –¢—Ä–µ–±—É–µ—Ç—Å—è |
| PyJWT | 2.x | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å

> [!example]- 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
> ```
> # 1.1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
> cd /root/test
> mkdir -p rutoken-military
> cd rutoken-military
> 
> # 1.2. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
> mkdir -p server client certs database
> ```

> [!example]- 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
> ```
> # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
> sudo apt-get update
> sudo apt-get install -y \
>     python3 \
>     python3-pip \
>     python3-cryptography \
>     openssl \
>     sqlite3
> 
> # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PyJWT
> sudo apt-get install python3-jwt
> # –ò–ª–∏ —á–µ—Ä–µ–∑ pip:
> # pip3 install --break-system-packages PyJWT
> ```

> [!example]- 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
> ```
> # –ü–æ–º–µ—Å—Ç–∏—Ç–µ –∫–æ—Ä–Ω–µ–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç CA
> cp /path/to/ca.cert.pem certs/ca.cert.pem
> 
> # –ü—Ä–æ–≤–µ—Ä–∫–∞
> openssl x509 -in certs/ca.cert.pem -text -noout
> ```

> [!example]- 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
> ```
> cd server
> python3 -c "from database import init_database; init_database()"
> ```

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å

> [!example]- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Ä–∞–±–æ—á–µ–º –º–µ—Å—Ç–µ
> ```
> # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
> sudo apt-get update
> sudo apt-get install -y \
>     python3 \
>     python3-pip \
>     python3-requests \
>     librtpkcs11ecp \
>     rutokenecp \
>     pcscd \
>     pcsc-tools \
>     opensc \
>     firefox
> 
> # –ó–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã PC/SC
> sudo systemctl enable pcscd
> sudo systemctl start pcscd
> 
> # –ü—Ä–æ–≤–µ—Ä–∫–∞ Rutoken
> pkcs11-tool --module /usr/lib/librtpkcs11ecp.so --list-slots
> ```

> [!tip] –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
> ```
> curl -O https://your-repo/install-client.sh
> chmod +x install-client.sh
> sudo ./install-client.sh
> ```

**–°–º. —Ç–∞–∫–∂–µ:**
- [[–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ - –¥–µ—Ç–∞–ª–∏]]
- [[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Rutoken]]
- [[–°–æ–∑–¥–∞–Ω–∏–µ CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞]]

---

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

> [!code]- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
> ```
> cd /root/test/rutoken-military/server
> python3 main.py
> ```

> [!success]- –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥
> ```
> [CONFIG] BASE_DIR: /root/test/rutoken-military
> [CONFIG] DB_PATH: /root/test/rutoken-military/database/auth.db
> [CONFIG] SECRET_KEY —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: 4a31ba3150111224...
> [DATABASE] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
> [RUTOKEN] –ó–∞–≥—Ä—É–∂–µ–Ω –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–π CA: CN=Belov CA
> ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
> ‚ïë  HTTP –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ 0.0.0.0:8443                 ‚ïë
> ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
> ‚ïë  üìç –î–û–°–¢–£–ü –° –î–†–£–ì–û–ì–û –ü–ö –í –°–ï–¢–ò:                       ‚ïë
> ‚ïë     http://192.168.1.100:8443/client/                 ‚ïë
> ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
> ```

> [!example]- –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ systemd (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
> ```
> # –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
> sudo tee /etc/systemd/system/rutoken-auth.service > /dev/null << 'EOF'
> [Unit]
> Description=Rutoken Authentication Server
> After=network.target
> 
> [Service]
> Type=simple
> User=root
> WorkingDirectory=/root/test/rutoken-military/server
> ExecStart=/usr/bin/python3 /root/test/rutoken-military/server/main.py
> Restart=always
> RestartSec=10
> 
> [Install]
> WantedBy=multi-user.target
> EOF
> 
> # –ó–∞–ø—É—Å–∫
> sudo systemctl daemon-reload
> sudo systemctl enable rutoken-auth
> sudo systemctl start rutoken-auth
> 
> # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
> sudo systemctl status rutoken-auth
> ```

### –ó–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞

> [!note] –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
> 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ Rutoken –∫ USB –ø–æ—Ä—Ç—É
> 2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–ª—É–∂–±–∞ pcscd –∑–∞–ø—É—â–µ–Ω–∞
> 3. –ó–Ω–∞–π—Ç–µ User PIN –æ—Ç —Ç–æ–∫–µ–Ω–∞

> [!code] –ó–∞–ø—É—Å–∫
> ```
> python3 ~/rutoken-client-lite.py
> ```

> [!tip] –°–æ–∑–¥–∞–Ω–∏–µ —è—Ä–ª—ã–∫–∞ –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ
> ```
> cat > ~/–†–∞–±–æ—á–∏–π\ —Å—Ç–æ–ª/rutoken-login.desktop << 'EOF'
> [Desktop Entry]
> Type=Application
> Name=–í—Ö–æ–¥ —á–µ—Ä–µ–∑ Rutoken
> Exec=python3 /home/USERNAME/rutoken-client-lite.py
> Icon=security-high
> Terminal=true
> Categories=Security;
> EOF
> 
> chmod +x ~/–†–∞–±–æ—á–∏–π\ —Å—Ç–æ–ª/rutoken-login.desktop
> ```

**–°–º. —Ç–∞–∫–∂–µ:**
- [[–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞]]
- [[–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ]]
- [[–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞]]

---

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

> [!todo] –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
> - [ ] –í—ã–¥–∞—Ç—å Rutoken –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
> - [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞ —Ç–æ–∫–µ–Ω
> - [ ] –°–æ–æ–±—â–∏—Ç—å User PIN
> - [ ] –ü—Ä–æ–∏–Ω—Å—Ç—Ä—É–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

> [!info] –ü—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞
> 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç Rutoken —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º
> 2. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–æ–±—â–∞–µ—Ç PIN-–∫–æ–¥ (–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç –µ–≥–æ)
> 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç –Ω–∞ —Å–≤–æ—ë–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
> 4. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
>    - –°–æ–∑–¥–∞—ë—Ç —É—á—ë—Ç–Ω—É—é –∑–∞–ø–∏—Å—å –≤ –ë–î
>    - –í—ã–¥–∞—ë—Ç JWT —Ç–æ–∫–µ–Ω—ã
>    - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ü–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```


# –ö–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –≤—Ö–æ–¥–µ:

python3 ~/rutoken-client-lite.py

```

### –†–∞–±–æ—Ç–∞ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã:

> [!check] Dashboard (`/client/dashboard.html`)
> - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
> - –°—Ç–∞—Ç—É—Å —Ç–æ–∫–µ–Ω–∞
> - –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏
> - –¢–µ—Å—Ç –∑–∞—â–∏—â—ë–Ω–Ω–æ–≥–æ API

> [!check] –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
> - –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞—é—Ç —Ç–æ–∫–µ–Ω
> - Access Token –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Refresh Token
> - –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ Refresh Token —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥

> [!check] –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
> 1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–í—ã–π—Ç–∏"
> 2. Refresh Token –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ Black-list
> 3. –¢–æ–∫–µ–Ω—ã —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
> 4. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞

**–°–º. —Ç–∞–∫–∂–µ:**
- [[Dashboard - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å]]
- [[–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏]]
- [[–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤—ã—Ö–æ–¥]]

---

## üõ°Ô∏è –ú–µ—Ö–∞–Ω–∏–∑–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

> [!quote] –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã
> ```
> –§–∞–∫—Ç–æ—Ä 1 (—á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å): –§–∏–∑–∏—á–µ—Å–∫–∏–π Rutoken —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º
> –§–∞–∫—Ç–æ—Ä 2 (—á—Ç–æ –≤—ã –∑–Ω–∞–µ—Ç–µ):  PIN-–∫–æ–¥ (6-32 —Å–∏–º–≤–æ–ª–∞)
> ```

> [!danger] –ó–∞—â–∏—Ç–∞
> - ‚ùå –£–∫—Ä–∞–¥–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –±–µ–∑ PIN-–∫–æ–¥–∞ **–±–µ—Å–ø–æ–ª–µ–∑–µ–Ω**
> - ‚ùå –£–∫—Ä–∞–¥–µ–Ω–Ω—ã–π PIN –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ **–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**
> - üîí –ü–æ—Å–ª–µ 3 –Ω–µ–≤–µ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ PIN —Ç–æ–∫–µ–Ω **–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞**

**–°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
- [[–ú–Ω–æ–≥–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è]]
- [[–ë–∏–æ–º–µ—Ç—Ä–∏—è vs PIN]]
- [[HSM –∏ –∫—Ä–∏–ø—Ç–æ—Ç–æ–∫–µ–Ω—ã]]

### JWT —Ç–æ–∫–µ–Ω—ã

> [!example]- Access Token (–∫–æ—Ä–æ—Ç–∫–∏–π)
> ```
> {
>   "user_id": "user_86169016",
>   "type": "access",
>   "iat": 1733167200,
>   "exp": 1733168100,
>   "jti": "unique_token_id",
>   "cv": 1
> }
> ```
> 
> **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
> - ‚è±Ô∏è –í—Ä–µ–º—è –∂–∏–∑–Ω–∏: **15 –º–∏–Ω—É—Ç**
> - üîë –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤
> - üíæ –•—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (localStorage)

> [!example]- Refresh Token (–¥–ª–∏–Ω–Ω—ã–π)
> ```
> {
>   "user_id": "user_86169016",
>   "type": "refresh",
>   "iat": 1733167200,
>   "exp": 1733772000,
>   "jti": "unique_token_id",
>   "cv": 1
> }
> ```
> 
> **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
> - ‚è±Ô∏è –í—Ä–µ–º—è –∂–∏–∑–Ω–∏: **7 –¥–Ω–µ–π**
> - üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Access Token
> - üö´ –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ Black-list

**–ü–æ–ª—è —Ç–æ–∫–µ–Ω–∞:**

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|------------|
| `user_id` | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
| `type` | –¢–∏–ø —Ç–æ–∫–µ–Ω–∞ | access / refresh |
| `iat` | Issued At | –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è |
| `exp` | Expiration | –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è |
| `jti` | JWT ID | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç–æ–∫–µ–Ω–∞ |
| `cv` | Credentials Version | –í–µ—Ä—Å–∏—è —É—á—ë—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |

### Credentials Versioning

> [!info] –ö–æ–Ω—Ü–µ–ø—Ü–∏—è
> –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç `credentials_version` –≤ –ë–î. –ü—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ –≤–µ—Ä—Å–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è, –∏ –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —Ç–æ–∫–µ–Ω—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏.

> [!code]- –°—Ö–µ–º–∞ –ë–î
> ```
> CREATE TABLE users (
>     user_id TEXT PRIMARY KEY,
>     credentials_version INTEGER DEFAULT 1,
>     certificate_serial TEXT NOT NULL,
>     subject TEXT NOT NULL,
>     created_at INTEGER NOT NULL
> );
> ```

> [!example]- –ü—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏
> ```
> # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤–µ—Ä—Å–∏—é
> UPDATE users SET credentials_version = credentials_version + 1 
> WHERE user_id = 'user_86169016';
> 
> # –í—Å–µ —Å—Ç–∞—Ä—ã–µ —Ç–æ–∫–µ–Ω—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏
> # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ
> ```

### Token Black-list

> [!info] –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
> –•—Ä–∞–Ω–∏—Ç –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è –∏—Ö —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è

> [!code]- –°—Ö–µ–º–∞ –ë–î
> ```
> CREATE TABLE token_blacklist (
>     jti TEXT PRIMARY KEY,
>     user_id TEXT NOT NULL,
>     token_type TEXT NOT NULL,
>     expires_at INTEGER NOT NULL,
>     blacklisted_at INTEGER NOT NULL
> );
> ```

> [!example]- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
> ```
> if is_blacklisted(token_jti):
>     return {'error': '–¢–æ–∫–µ–Ω –æ—Ç–æ–∑–≤–∞–Ω'}
> ```

> [!tip] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
> ```
> # –£–¥–∞–ª—è–µ–º –∏—Å—Ç—ë–∫—à–∏–µ —Ç–æ–∫–µ–Ω—ã –∏–∑ Black-list
> cleanup_blacklist()  # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏
> ```

### Proof-of-Possession

> [!info] –î–ª—è Rutoken lite (–±–µ–∑ –∫—Ä–∏–ø—Ç–æ–ø–æ–¥–ø–∏—Å–∏)

> [!code] –°–æ–∑–¥–∞–Ω–∏–µ proof
> ```
> # –°–æ–∑–¥–∞—ë—Ç—Å—è —Ö–µ—à –æ—Ç:
> proof = SHA256(
>     cert_hash + 
>     pin_hash + 
>     timestamp + 
>     token_serial
> )
> ```

> [!check] –≠—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ:
> - ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ç–æ–∫–µ–Ω—É (cert + serial)
> - ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–Ω–∞–µ—Ç PIN (pin_hash)
> - ‚úÖ –ó–∞–ø—Ä–æ—Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π (timestamp)

### –ú–∞—Ç—Ä–∏—Ü–∞ –∑–∞—â–∏—Ç—ã –æ—Ç –∞—Ç–∞–∫

| –ê—Ç–∞–∫–∞ | –ó–∞—â–∏—Ç–∞ | –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å |
|-------|--------|---------------|
| **–ö—Ä–∞–∂–∞ Access Token** | –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç | üü¢ –í—ã—Å–æ–∫–∞—è |
| **–ö—Ä–∞–∂–∞ Refresh Token** | –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ Black-list | üü¢ –í—ã—Å–æ–∫–∞—è |
| **Replay –∞—Ç–∞–∫–∞** | Timestamp –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ | üü¢ –í—ã—Å–æ–∫–∞—è |
| **MITM** | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ | üü° –°—Ä–µ–¥–Ω—è—è |
| **–ë—Ä—É—Ç—Ñ–æ—Ä—Å PIN** | –ü–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫ —Ç–æ–∫–µ–Ω –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è | üü¢ –í—ã—Å–æ–∫–∞—è |
| **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞** | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–µ –ø–æ–∫–∏–¥–∞–µ—Ç Rutoken | üü¢ –ê–±—Å–æ–ª—é—Ç–Ω–∞—è |
| **–ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞** | Credentials versioning –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Å–µ —Ç–æ–∫–µ–Ω—ã | üü¢ –í—ã—Å–æ–∫–∞—è |

**–°–º. —Ç–∞–∫–∂–µ:**
- [[–ê–Ω–∞–ª–∏–∑ —É–≥—Ä–æ–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏]]
- [[–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ JWT]]
- [[OWASP Top 10 –∑–∞—â–∏—Ç–∞]]

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```

rutoken-military/
‚îú‚îÄ‚îÄ üìÇ server/                      \# –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ üêç main.py                  \# –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ ‚öôÔ∏è config.py                \# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ üåê http_server.py           \# HTTP —Å–µ—Ä–≤–µ—Ä (–±–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ üîê auth_service.py          \# –õ–æ–≥–∏–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ ‚úÖ rutoken_validator.py     \# –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ üíæ database.py              \# –†–∞–±–æ—Ç–∞ —Å SQLite
‚îÇ
‚îú‚îÄ‚îÄ üìÇ client/                      \# –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ   ‚îú‚îÄ‚îÄ üè† index.html               \# –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ ‚ú® auth-success.html        \# –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îî‚îÄ‚îÄ üìä dashboard.html           \# –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
‚îÇ
‚îú‚îÄ‚îÄ üìÇ certs/                       \# –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ üìú ca.cert.pem              \# –ö–æ—Ä–Ω–µ–≤–æ–π CA
‚îÇ
‚îú‚îÄ‚îÄ üìÇ database/                    \# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ üíæ auth.db                  \# SQLite –±–∞–∑–∞ (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ
‚îú‚îÄ‚îÄ üêç rutoken-client-lite.py       \# –ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ
‚îî‚îÄ‚îÄ üìñ README.md                    \# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

```

**–û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π:**

> [!info]- [[server/main.py]]
> –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç HTTP —Å–µ—Ä–≤–µ—Ä.

> [!info]- [[server/config.py]]
> –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º, SECRET_KEY, –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–æ–≤.

> [!info]- [[server/http_server.py]]
> –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π HTTP —Å–µ—Ä–≤–µ—Ä –Ω–∞ —á–∏—Å—Ç–æ–º Python –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤.

> [!info]- [[server/auth_service.py]]
> –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: –≤–∞–ª–∏–¥–∞—Ü–∏—è, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏.

> [!info]- [[server/rutoken_validator.py]]
> –†–∞–±–æ—Ç–∞ —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏: –ø–∞—Ä—Å–∏–Ω–≥, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ CA.

> [!info]- [[server/database.py]]
> –†–∞–±–æ—Ç–∞ —Å SQLite: CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏, –º–∏–≥—Ä–∞—Ü–∏–∏, queries.

**–°–º. —Ç–∞–∫–∂–µ:**
- [[–î–µ—Ç–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞]]
- [[Code style guide]]
- [[–ú–æ–¥—É–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ]]

---

## üîå API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ë–∞–∑–æ–≤—ã–π URL

```

http://SERVER_IP:8443/api

```

### Endpoints

#### `POST /api/auth/login`

> [!api] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Rutoken

**Request:**
```

{
"certificate": "-----BEGIN CERTIFICATE-----\nMIIE...\n-----END CERTIFICATE-----",
"signature": "proof_hash_string",
"data": "1733167200",
"token_serial": "383d5d3c"
}

```

**Response 200 OK:**
```

{
"access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
"refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
"token_type": "Bearer",
"expires_in": 900,
"user_id": "user_86169016"
}

```

**Response 401 Unauthorized:**
```

{
"error": "–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏—Å—Ç—ë–∫"
}

```

---

#### `POST /api/auth/refresh`

> [!api] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Access Token

**Request:**
```

{
"refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}

```

**Response 200 OK:**
```

{
"access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
"token_type": "Bearer",
"expires_in": 900
}

```

---

#### `POST /api/auth/logout`

> [!api] –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã (–æ—Ç–∑—ã–≤ Refresh Token)

**Request:**
```

{
"refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}

```

**Response 200 OK:**
```

{
"message": "–£—Å–ø–µ—à–Ω—ã–π –≤—ã—Ö–æ–¥"
}

```

---

#### `POST /api/protected`

> [!api] –ü—Ä–∏–º–µ—Ä –∑–∞—â–∏—â—ë–Ω–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞

**Headers:**
```

Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

```

**Response 200 OK:**
```

{
"message": "–î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω",
"user_id": "user_86169016",
"expires_at": 1733168100
}

```

**Response 401 Unauthorized:**
```

{
"error": "–¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫"
}

```

### –ö–æ–¥—ã –æ—à–∏–±–æ–∫

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ |
|-----|----------|----------|
| 200 | OK | –ó–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω |
| 401 | Unauthorized | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω |
| 403 | Forbidden | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ |
| 500 | Internal Server Error | –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É |

**–°–º. —Ç–∞–∫–∂–µ:**
- [[API –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è]]
- [[Postman –∫–æ–ª–ª–µ–∫—Ü–∏—è]]
- [[Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]]

---

## üêõ Troubleshooting

### Rutoken –Ω–µ –Ω–∞–π–¥–µ–Ω

> [!bug] –°–∏–º–ø—Ç–æ–º—ã
> ```
> ‚ùå Rutoken –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∫ USB.
> ```

> [!example]- –†–µ—à–µ–Ω–∏–µ
> ```
> # 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ USB –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
> lsusb | grep -i rutoken
> lsusb | grep -i aktiv
> 
> # 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª—É–∂–±—É pcscd
> sudo systemctl status pcscd
> sudo systemctl restart pcscd
> 
> # 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É PKCS#11
> ls -la /usr/lib/librtpkcs11ecp.so
> 
> # 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø
> pkcs11-tool --module /usr/lib/librtpkcs11ecp.so --list-slots
> ```

**–°–º. —Ç–∞–∫–∂–µ:** [[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Rutoken - –¥–µ—Ç–∞–ª–∏]]

---

### –ù–µ–≤–µ—Ä–Ω—ã–π PIN

> [!bug] –°–∏–º–ø—Ç–æ–º—ã
> ```
> ‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è: CKR_PIN_INCORRECT (0xa0)
> ```

> [!warning] –í–∞–∂–Ω–æ
> - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–≤–æ–¥–∏—Ç–µ **User PIN**, –∞ –Ω–µ **SO PIN** (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)
> - User PIN –æ–±—ã—á–Ω–æ 6-8 —Ü–∏—Ñ—Ä
> - ‚ö†Ô∏è –ü–æ—Å–ª–µ 3 –Ω–µ–≤–µ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ —Ç–æ–∫–µ–Ω –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

> [!example]- –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (–µ—Å–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)
> ```
> # –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ SO PIN (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
> pkcs11-tool --module /usr/lib/librtpkcs11ecp.so \
>     --init-pin \
>     --so-pin ADMIN_PIN \
>     --new-pin NEW_USER_PIN
> ```

**–°–º. —Ç–∞–∫–∂–µ:** [[–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ PIN]]

---

### –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω

> [!bug] –°–∏–º–ø—Ç–æ–º—ã
> ```
> ‚ùå –ù–∞ —Ç–æ–∫–µ–Ω–µ –Ω–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤!
> error: object not found
> ```

> [!example]- –ü—Ä–æ–≤–µ—Ä–∫–∞
> ```
> # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—ä–µ–∫—Ç—ã –Ω–∞ —Ç–æ–∫–µ–Ω–µ
> pkcs11-tool --module /usr/lib/librtpkcs11ecp.so \
>     --login \
>     --list-objects
> 
> # –î–æ–ª–∂–µ–Ω –±—ã—Ç—å "Certificate Object"
> ```

> [!example]- –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –Ω–∞ —Ç–æ–∫–µ–Ω
> ```
> # –ò–º–ø–æ—Ä—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
> pkcs11-tool --module /usr/lib/librtpkcs11ecp.so \
>     --login \
>     --write-object /path/to/cert.der \
>     --type cert \
>     --id 01 \
>     --label "My Certificate"
> ```

**–°–º. —Ç–∞–∫–∂–µ:** [[–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ –Ω–∞ Rutoken]]

---

### –ù–µ —É–¥–∞—ë—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É

> [!bug] –°–∏–º–ø—Ç–æ–º—ã
> ```
> ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É http://192.168.31.55:8443
> ```

> [!example]- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
> ```
> # 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
> ps aux | grep main.py
> 
> # 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
> ping 192.168.31.55
> 
> # 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall
> sudo iptables -L -n | grep 8443
> 
> # –û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç (–µ—Å–ª–∏ –∑–∞–∫—Ä—ã—Ç)
> sudo iptables -A INPUT -p tcp --dport 8443 -j ACCEPT
> 
> # 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç –Ω–∞ 0.0.0.0
> netstat -tuln | grep 8443
> ```

**–°–º. —Ç–∞–∫–∂–µ:** [[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–∏]]

---

### –¢–æ–∫–µ–Ω—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ

> [!bug] –°–∏–º–ø—Ç–æ–º—ã
> - –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–¢–æ–∫–µ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
> - Dashboard –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

> [!example]- –†–µ—à–µ–Ω–∏–µ
> ```
> # 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
> # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "‚úÖ –¢–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage"
> 
> # 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ localStorage –≤ –∫–æ–Ω—Å–æ–ª–∏:
> localStorage.getItem('access_token')
> localStorage.getItem('refresh_token')
> localStorage.getItem('user_id')
> 
> # 3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±—Ä–∞—É–∑–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç localStorage
> # (–≤—Å–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç)
> 
> # 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è cookies/localStorage
> # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Firefox -> –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å -> –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∑–∞—â–∏—Ç–∞
> ```

**–°–º. —Ç–∞–∫–∂–µ:** [[–û—Ç–ª–∞–¥–∫–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞]]

---

### ModuleNotFoundError: No module named 'jwt'

> [!bug] –°–∏–º–ø—Ç–æ–º—ã
> ```
> ModuleNotFoundError: No module named 'jwt'
> ```

> [!example]- –†–µ—à–µ–Ω–∏–µ
> ```
> # –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ apt
> sudo apt-get install python3-jwt
> 
> # –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ pip
> pip3 install --break-system-packages PyJWT
> 
> # –í–∞—Ä–∏–∞–Ω—Ç 3: –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
> cd /root/test/rutoken-military/server
> python3 -m venv venv
> source venv/bin/activate
> pip install PyJWT cryptography
> python main.py
> ```

**–°–º. —Ç–∞–∫–∂–µ:** [[–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ Python]]

---

### –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é CA

> [!bug] –°–∏–º–ø—Ç–æ–º—ã
> ```
> [RUTOKEN] ‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å—å CA
> ```

> [!example]- –†–µ—à–µ–Ω–∏–µ
> ```
> # 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
> ls -la /root/test/rutoken-military/certs/ca.cert.pem
> 
> # 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å PEM)
> openssl x509 -in certs/ca.cert.pem -text -noout
> 
> # 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–¥–ø–∏—Å–∞–Ω —ç—Ç–∏–º CA
> openssl verify -CAfile certs/ca.cert.pem user_cert.pem
> 
> # 4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç—å —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤ config.py
> grep CA_CERT_PATH server/config.py
> ```

**–°–º. —Ç–∞–∫–∂–µ:** [[–†–∞–±–æ—Ç–∞ —Å CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏]]

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

> [!tip]- 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
> ```
> # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
> openssl req -x509 -newkey rsa:4096 \
>     -keyout server.key -out server.crt \
>     -days 365 -nodes
> 
> # –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Let's Encrypt
> ```

> [!tip]- 2. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É
> ```
> # Firewall –ø—Ä–∞–≤–∏–ª–∞
> sudo iptables -A INPUT -p tcp -s 192.168.1.0/24 --dport 8443 -j ACCEPT
> sudo iptables -A INPUT -p tcp --dport 8443 -j DROP
> ```

> [!tip]- 3. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
> ```
> sudo apt-get update && sudo apt-get upgrade
> ```

> [!tip]- 4. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏
> ```
> tail -f /var/log/rutoken-auth.log
> ```

> [!tip]- 5. –î–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –ë–î
> ```
> cp database/auth.db database/auth.db.backup.$(date +%Y%m%d)
> ```

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

> [!warning] –ü—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
> 1. ‚ùå **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–æ–±—â–∞–π—Ç–µ PIN –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–º**
> 2. üö´ **–ù–µ –æ—Å—Ç–∞–≤–ª—è–π—Ç–µ Rutoken –≤ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –±–µ–∑ –ø—Ä–∏—Å–º–æ—Ç—Ä–∞**
> 3. üìû **–ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ç–æ–∫–µ–Ω–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Å–æ–æ–±—â–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É**
> 4. üî¢ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–π PIN (–Ω–µ 123456)**
> 5. üñ•Ô∏è **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—â–∏–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã –¥–ª—è –≤—Ö–æ–¥–∞**

**–°–º. —Ç–∞–∫–∂–µ:**
- [[Security best practices]]
- [[NIST —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏]]
- [[Incident response plan]]

---

## üìä –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫

> [!tip] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
> 1. **PostgreSQL –≤–º–µ—Å—Ç–æ SQLite** - –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫
> 2. **Load Balancer** - –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
> 3. **Redis –¥–ª—è Black-list** - –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
> 4. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ Auth –∏ API Server** - –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–°–º. —Ç–∞–∫–∂–µ:**
- [[–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ - –¥–µ—Ç–∞–ª–∏]]
- [[High Availability –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è]]
- [[–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏]]

---

## üìù –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

> [!info] –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–∫—É–º–µ–Ω—Ç–µ
> - **–í–µ—Ä—Å–∏—è:** 1.0.0
> - **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-03
> - **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-03
> - **–ê–≤—Ç–æ—Ä:** Security Team
> - **–°—Ç–∞—Ç—É—Å:** ‚úÖ Complete
> - **–¢–µ–≥–∏:** #rutoken #security #authentication #astra-linux #2fa #jwt

**–°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:**
- [[–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞]]
- [[–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]]
- [[–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞]]
- [[API Reference]]
- [[Security Audit Report]]

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

> [!contact] –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
> –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∏—Å—Ç–µ–º—ã.

**–°–º. —Ç–∞–∫–∂–µ:**
- [[FAQ - –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã]]
- [[–§–æ—Ä—É–º —Å–æ–æ–±—â–µ—Å—Ç–≤–∞]]
- [[–ë–∞–≥-—Ç—Ä–µ–∫–µ—Ä]]

---

**üîê –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏ –≤–æ–µ–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö**  
**üá∑üá∫ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ –æ—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –æ—Ç–∫—Ä—ã—Ç—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥**
